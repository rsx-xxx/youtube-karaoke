<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Karaoke Studio</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Transform YouTube videos into karaoke with AI-powered vocal separation and lyrics synchronization.">
    <meta name="theme-color" content="#6366f1" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#4f46e5" media="(prefers-color-scheme: light)">
    <meta name="color-scheme" content="dark light">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Fonts - Inter for UI, Montserrat for display/subtitles -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="dns-prefetch" href="//i.ytimg.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="/assets/css/base.css"/>
    <link rel="stylesheet" href="/assets/css/layout.css"/>
    <link rel="stylesheet" href="/assets/css/components/input.css"/>
    <link rel="stylesheet" href="/assets/css/components/options.css"/>
    <link rel="stylesheet" href="/assets/css/components/genius.css"/>
    <link rel="stylesheet" href="/assets/css/components/progress.css"/>
    <link rel="stylesheet" href="/assets/css/components/results.css"/>
    <link rel="stylesheet" href="/assets/css/components/stems.css"/>
    <link rel="stylesheet" href="/assets/css/components/theme.css"/>
    <link rel="stylesheet" href="/assets/css/components/misc.css"/>

    <!-- Favicon -->
    <link id="favicon" rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üé§</text></svg>">
</head>
<body>
    <!-- Animated Background -->
    <div id="gradient-background" aria-hidden="true"></div>
    <div class="noise-overlay" aria-hidden="true"></div>

    <!-- Theme Toggle -->
    <button id="theme-switcher" class="theme-toggle" title="Toggle theme" aria-label="Toggle dark/light theme">
        <span class="theme-icon sun">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"/>
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
            </svg>
        </span>
        <span class="theme-icon moon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
        </span>
    </button>

    <main class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üé§</span>
                <h1>Karaoke Studio</h1>
            </div>
            <p class="tagline">Transform any YouTube video into karaoke magic</p>
        </header>

        <!-- Input Section -->
        <section class="input-section">
            <div class="input-wrapper">
                <div class="input-group glass-card">
                    <div class="input-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                        </svg>
                    </div>
                    <input
                        type="text"
                        id="youtube-url"
                        placeholder="Paste YouTube URL or search for a song..."
                        aria-label="YouTube URL or Search Query"
                        aria-autocomplete="list"
                        aria-controls="suggestion-dropdown"
                        autocomplete="off"
                    />
                    <div id="suggestion-spinner" class="spinner" style="display: none;" aria-hidden="true"></div>
                    <button id="process-btn" class="process-button">
                        <span class="btn-text">Create Karaoke</span>
                        <span class="btn-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                        </span>
                    </button>
                </div>
                <div id="suggestion-dropdown" class="suggestion-dropdown glass-card" role="listbox" style="visibility: hidden; opacity: 0;"></div>
            </div>

            <!-- Preview -->
            <div class="preview-section" id="preview-section" style="display: none;">
                <div class="preview-card glass-card">
                    <img id="video-preview" alt="Video thumbnail" />
                    <div class="preview-info">
                        <span id="chosen-video-title" class="preview-title"></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Options -->
        <div id="options-wrapper">
            <section id="subtitle-options-container" class="options-section glass-card" style="display: none; opacity: 0; max-height: 0;">
                <h3 class="section-title">
                    <span class="title-icon">‚öôÔ∏è</span>
                    Settings
                </h3>

                <div class="options-grid">
                    <!-- Add Lyrics Toggle -->
                    <div class="option-card">
                        <label class="toggle-wrapper">
                            <input type="checkbox" id="generate-subtitles-checkbox" checked/>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Add Lyrics</span>
                        </label>
                    </div>

                    <!-- Language -->
                    <div class="option-card">
                        <label for="language-select" class="option-label">Language</label>
                        <div class="select-wrapper">
                            <select id="language-select" aria-label="Select transcription language">
                                <option value="auto" selected>Auto-Detect</option>
                                <option value="en">English</option>
                                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                                <option value="ja">Êó•Êú¨Ë™û</option>
                                <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                                <option value="zh">‰∏≠Êñá</option>
                                <option value="fr">Fran√ßais</option>
                                <option value="de">Deutsch</option>
                                <option value="es">Espa√±ol</option>
                                <option value="it">Italiano</option>
                                <option value="pt">Portugu√™s</option>
                            </select>
                            <span class="select-arrow">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </span>
                        </div>
                    </div>

                    <!-- Position -->
                    <div class="option-card">
                        <label for="subtitle-position-select" class="option-label">Position</label>
                        <div class="select-wrapper">
                            <select id="subtitle-position-select" aria-label="Select lyrics position">
                                <option value="bottom" selected>Bottom</option>
                                <option value="top">Top</option>
                            </select>
                            <span class="select-arrow">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </span>
                        </div>
                    </div>

                    <!-- Font Size -->
                    <div class="option-card">
                        <label for="final-subtitle-size-select" class="option-label">Text Size</label>
                        <div class="select-wrapper">
                            <select id="final-subtitle-size-select" aria-label="Select subtitle font size">
                                <option value="24">Small</option>
                                <option value="30" selected>Medium</option>
                                <option value="36">Large</option>
                                <option value="42">X-Large</option>
                            </select>
                            <span class="select-arrow">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Genius Lyrics Section -->
                <section id="genius-lyrics-container" class="lyrics-section" style="display: none; opacity: 0; max-height: 0;">
                    <div class="lyrics-header">
                        <h4 id="genius-heading">
                            <span class="title-icon">üéµ</span>
                            Lyrics Source
                        </h4>
                        <button id="lyrics-toggle-btn" class="expand-btn" aria-label="Toggle lyrics preview" aria-expanded="false">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </button>
                    </div>
                    <ul id="genius-lyrics-list" class="lyrics-list" role="listbox" aria-labelledby="genius-heading"></ul>
                    <div id="lyrics-panel" class="lyrics-preview hidden">
                        <textarea id="genius-selected-text" readonly aria-label="Selected lyrics preview" placeholder="Select a lyrics source above to preview..."></textarea>
                    </div>
                </section>
            </section>
        </div>

        <!-- Progress Section -->
        <section id="progress-display" class="progress-section glass-card" style="display: none;" aria-live="polite">
            <div class="progress-header">
                <div class="progress-info">
                    <span id="progress-text" class="progress-status">Initializing...</span>
                    <span id="progress-timing" class="progress-time">Elapsed: 0s</span>
                </div>
                <button id="cancel-job-btn" class="cancel-btn" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                    <span>Cancel</span>
                </button>
            </div>

            <div class="progress-bar-wrapper">
                <div id="progress-bar-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <div id="progress-bar"></div>
                </div>
                <span class="progress-percent" id="progress-percent">0%</span>
            </div>

            <div id="progress-steps-container" class="steps-container" aria-label="Processing steps"></div>
        </section>

        <!-- Status Message -->
        <div id="status-message" class="status-toast" role="alert" style="opacity: 0; max-height: 0;"></div>

        <!-- Results Layout (Split View) -->
        <div id="results-layout" class="results-layout" data-lyrics-expanded="false">
            <!-- Main Results Panel (Left side when lyrics expanded) -->
            <section class="results-area glass-card" style="display: none;">
                <div class="results-header">
                    <h2 id="video-title" class="results-title">Your Karaoke Video</h2>
                    <div class="results-actions">
                        <div class="results-badge">Ready</div>
                        <button id="toggle-lyrics-sidebar" class="toggle-lyrics-btn" title="Toggle lyrics panel">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="expand-icon">
                                <path d="M9 18l6-6-6-6"/>
                            </svg>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="collapse-icon" style="display:none">
                                <path d="M15 18l-6-6 6-6"/>
                            </svg>
                            <span class="btn-label">Lyrics</span>
                        </svg>
                        </button>
                    </div>
                </div>

                <div class="video-wrapper">
                    <video id="karaoke-video" controls controlsList="nodownload" title="Generated Karaoke Video">
                        Your browser does not support the video tag.
                    </video>
                </div>

                <div class="video-actions">
                    <a id="download-btn" href="#" download="karaoke_video.mp4" class="action-btn primary" style="display: none;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <span>Download</span>
                    </a>
                    <button id="share-btn" class="action-btn secondary" style="display: none;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="18" cy="5" r="3"/>
                            <circle cx="6" cy="12" r="3"/>
                            <circle cx="18" cy="19" r="3"/>
                            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                        </svg>
                        <span>Share Link</span>
                    </button>
                </div>

                <!-- Stems Section -->
                <div id="stems-section" class="stems-section" style="display: none;">
                    <div class="stems-header">
                        <h3 class="stems-title">
                            <span class="title-icon">üéöÔ∏è</span>
                            Audio Stems
                        </h3>

                        <!-- Track Info (BPM and Key) -->
                        <div class="track-info">
                            <span class="info-badge">
                                <span class="info-label">BPM</span>
                                <span id="track-bpm" class="info-value">--</span>
                            </span>
                            <span class="info-badge">
                                <span class="info-label">Key</span>
                                <span id="track-key" class="info-value" data-original-key="">--</span>
                                <span id="track-key-transposed" class="transposed-key"></span>
                            </span>
                        </div>

                        <div id="global-stem-controls" class="global-controls">
                            <button id="play-all-stems" class="stem-control-btn" title="Play/Pause All" disabled>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="play-icon">
                                    <polygon points="5 3 19 12 5 21 5 3"/>
                                </svg>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="pause-icon" style="display:none">
                                    <rect x="6" y="4" width="4" height="16"/>
                                    <rect x="14" y="4" width="4" height="16"/>
                                </svg>
                            </button>
                            <button id="reset-all-stems" class="stem-control-btn" title="Reset All" disabled>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="19 20 9 12 19 4 19 20"/>
                                    <line x1="5" y1="19" x2="5" y2="5"/>
                                </svg>
                            </button>
                            <div class="pitch-control">
                                <label for="global-pitch">Pitch</label>
                                <input type="range" id="global-pitch" min="-12" max="12" step="1" value="0" disabled/>
                                <span id="global-pitch-value">0 st</span>
                                <button id="reset-pitch" class="reset-btn" disabled title="Reset pitch to 0">0</button>
                            </div>
                            <div class="speed-control">
                                <label for="global-speed">Speed</label>
                                <input type="range" id="global-speed" min="0.5" max="2.0" step="0.05" value="1.0" disabled/>
                                <span id="global-speed-value">1.00x</span>
                            </div>
                            <label class="lock-control">
                                <input type="checkbox" id="lock-stems" checked disabled/>
                                <span class="lock-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                    </svg>
                                </span>
                                <span>Sync</span>
                            </label>
                        </div>
                    </div>

                    <div id="stems-container" class="stems-grid" aria-label="Individual audio stem players"></div>
                </div>
            </section>

            <!-- Lyrics Sidebar (Right side) -->
            <aside id="lyrics-sidebar" class="lyrics-sidebar glass-card">
                <div class="lyrics-sidebar-header">
                    <h3 class="lyrics-sidebar-title">
                        <span class="title-icon">üìù</span>
                        Song Lyrics
                    </h3>
                    <button id="close-lyrics-sidebar" class="close-sidebar-btn" title="Close lyrics panel">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="lyrics-sidebar-content">
                    <textarea id="full-lyrics-textarea" class="full-lyrics-textarea" placeholder="Lyrics will appear here after processing..." readonly></textarea>
                </div>
            </aside>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>Powered by AI: Whisper + Demucs + Genius</p>
    </footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/wavesurfer.js@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/soundtouchjs@0.1.30/dist/soundtouch.min.js"></script>
    <script type="module" src="/assets/js/app.js"></script>
</body>
</html>
